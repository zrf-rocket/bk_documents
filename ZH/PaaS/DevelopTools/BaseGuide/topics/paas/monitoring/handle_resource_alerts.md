# 当出现资源使用量告警时该怎么处理

## 当出现内存告警时

如果蓝鲸应用的内存不够用了，在咨询蓝鲸助手之前，可以先做这几件事。

### 尝试通过横向扩容解决问题

所谓的“横向扩容”，就是通过增加实例数来增加进程的负载能力。平台在 **进程管理页面** 已经赋予了开发者这样的能力。

![-w2021](../../../images/docs/scale_process.png)

横向扩容适用于由于任务数增多导致的 OOM。

例如，当 `celery worker` 由于任务过多而导致消息堆积，想要通过增加 worker 数量来解决问题时，在这里平台**更推荐**先考虑横向扩容——即增加 celery 进程的实例数，因为直接修改启动命令调大 `--concurrency` 就很有可能发生 OOM。

当然，如果 OOM 的原因是因为单个任务或者请求吃掉了过多的内存，例如读取某些超大的文件，就只能纵向扩容了，这时请联系蓝鲸助手协助增加。

### 针对 gunicorn 启动的进程

当应用进程是通过 gunicorn 启动的，可以观察应用内存资源曲线，如果使用量是缓慢增常，并且最后超限，那么有很大概率在**代码中存在内存泄漏**。

可以通过增加 gunicorn 启动参数来规避这个问题，类似下面：

```bash
--max-requests 1024 --max-requests-jitter 50
```

详情可以参考： [Gunicorn max-requests 参数](https://docs.gunicorn.org/en/18.0/settings.html#max-requests)

## 当出现 CPU 告警时

如果应用 CPU 出现高负载，而应用本身并不进行“CPU 密集型”计算（大多是 web 应用都是 `IO 密集型`），那么很有可能出现了类似“死循环”占用 CPU 的问题。

这时候盲目扩容并不能解决问题，需要仔细排查代码中的“雷”，找到 CPU 占用的原因。

相反地，如果应用确实需要较多的 CPU 计算资源，请联系蓝鲸助手，平台会拉群专门评估资源用量以符合应用需求。
