# 有权限的资源列表

## 背景

系统接入权限中心后, 用户相关的权限都在权限中心统一维护. 

系统产品上, 用户登录后, 需要展示有权限的资源列表, 例如`用户1有主机编辑权限的所有主机列表`

此时, 所有的`主机资源`是接入系统自己维护的, 而`用户 1 的主机编辑权限`是权限中心维护的.

由于权限中心没有持有`资源`, 所以获取有权限的资源列表需要接入系统查询获取策略后进行处理

## 方案 1: 表达式解析

> 推荐做法

将权限中心的条件表达式, 转换成系统自己存储的查询语句, 例如 sql, django queryset, mongodb query 或者 elasticsearch Query DSL. 

在 [Python SDK](https://github.com/TencentBlueKing/iam-python-sdk/tree/master/iam/contrib/converter) 中, 我们给到了两种实现, 具体见文档: [表达式解析](../../Reference/Expression/03-Translate.md)

如果系统实现了相关存储的表达式解析, 欢迎贡献 PR 到对应的 SDK 仓库.

## 方案 2: 批量鉴权

> 小规模资源

使用 SDK 进行鉴权的逻辑是, 查询`用户 1 编辑主机`的权限策略到本地, 然后将资源带入进行计算, 而计算是在内存中进行的, 效率非常高.

批量 1000 台主机鉴权, 也是一次策略查询, 然后将 1000 台主机循环带入计算.

具体实现可以参考各个 SDK 提供的批量鉴权接口 [Python SDK](../../Reference/SDK/01-PythonSDK.md) / [Go SDK](../../Reference/SDK/02-GoSDK.md) / [Java SDK](../../Reference/SDK/03-JavaSDK.md) / [PHP SDK](../../Reference/SDK/05-PHPSDK.md)

所以, 如果接入资源的规模可控, 可以使用批量鉴权的方式实现.

## 方案 3: 自行转换

接入系统的资源存储可能非常复杂, 多个表, 甚至是依赖外部的服务拉取.

此时, 前两个方案可能解决不了问题, 此时, 需要系统自行将策略表达式转换成等价的`查询+过滤`.

注意: 这类场景权限中心是无法处理的, 需要接入系统理解权限中心的策略表达式, 并做等价的转换. 

建议接入系统权限模型尽量简单, 资源尽量是`实体`资源(例如对应 db 一个表), 而不是`抽象`资源.

