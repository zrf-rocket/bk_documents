# 权限中心限制

## 1. 背景

如果在调用 API 或者使用产品时, 可能会出现错误消息, 提示某些数据超过了限制, 那么可能触发了某些阈值;

请根据错误提示, 阅读并确认

## 2. 限制


### 2.1 系统模型限制

- 一个 appCode 只能注册 1 个 system(限制 system_id 必须等于 app_code)
- 一个系统最多能注册 100 个操作(action)
- 一个系统最多能注册 50 个资源类型(resourceType)
- 一个系统最多能注册 50 个实例视图(instanceSelection)

### 2.2 产品使用限制

| 限制类型 | 限制项 | 最大值 | 其他限制说明 |
| ------ | ------ | ------ | ------ |
| 用户 | 一个用户可加入授权了同一个系统权限的用户组个数 | 100 | |
| | 一个用户可绑定的策略中的实例个数 | 10000 | 具体见: 大规模实例级权限限制 |
| | 一个用户可加入的分级管理员个数 | 100 | |
| 用户组 | 一个用户组可以绑定一个系统的权限模板个数 | 10 | |
| | 一个用户组可添加的成员(用户或组织)个数 | 500 | |
| | 一个用户组可绑定的策略中的实例个数 | 10000 | 具体见: 大规模实例级权限限制 |
|分级管理员 | 一个分级管理员可创建的用户组个数 | 100 | |
| | 一个分级管理员可添加的成员个数 | 100 | |
| | 所有系统可创建的分级管理员个数 | 3000 | |

一个用户可加入授权了同一个系统权限的用户组个数 说明:

- 比如用户A, 加入授权了`bk_cmdb`系统的用户组达到100个, 则不能再加入新的授权了`bk_cmdb`系统的用户组
- 比如用户A, 加入授权了`bk_job`系统的用户组达到50个, 则还能再加入新的授权了`bk_job`系统的用户组50个
- 这个数量限制对每个系统做了隔离, 不同的系统互不影响, 同一个用户组授权了多个系统, 则占用用户组成员多个系统的数量配额

### 2.3 名称限制

- 系统 ID(system_id) :  最大 32 个字符; 允许小写字母开头、包含小写字母、数字、下划线(_)和连接符(-)
- 操作 ID(action_id) : 最大 32 个字符; 允许小写字母开头、包含小写字母、数字、下划线(_)和连接符(-)
- 资源类型 ID(resource_type ID) : 最大 32 个字符; 允许小写字母开头、包含小写字母、数字、下划线(_)和连接符(-)
- 用户组名称: 最大 128 (最小为 5)个字符; (分级管理员下唯一)
- 分级管理员名称: 最大 128 个字符; (全局唯一)
- 权限模板名称: 最大 128 个字符
- 常用操作: 最大 128 个字符

## 3. 常见问题

### 3.1 系统有 10000 个操作需要注册, 怎么办 

默认操作应该是`可枚举`的, 经过评估, 平台类的大型系统, 正常操作也不会超过 100 个; 

如果超过 100 个, 需要考虑自身的权限模型是否合理;

一个系统最多 100 个操作的限制, 防止某些系统每新增一个实例就注册增删改查四个操作进来, 导致用户在配置这个系统权限时基本不可用;


### 3.2 操作 ID 长度 32 位限制, 能否放开到 256

不能, 操作 ID 是一个操作的标识;  是权限中心数据库索引及缓存索引中一个关键值, 长度更长会导致整体的性能下降;

而且, 操作 ID 仅仅是标识而已, 并不需要展示给普通的用户, 所以对可读性要求不高;

某些系统的 ID 是 64/128/256 甚至更长的, 权限中心不可能满足所有接入需求; 

一旦长度可能超过 32 位, 接入系统, 需要: 建立映射表关系, 自身系统的操作 ID 映射成权限的操作 ID, 鉴权时进行转换 (可以使用整数 ID, 或者字符串前缀+随机字符)

### 3.3 限制一个人同一个操作最多能配置 10000 个实例, 能否放开

不能; 具体见 [大规模实例级权限限制](06-LargeScaleInstances.md)




