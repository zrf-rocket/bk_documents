# 滚动执行

当我们有一个任务需要在很多台服务器上（几百甚至几千、几万台）执行时，为了避免因并发量过大对服务产生冲击，亦或者为了逐步观察执行后的效果，就可以利用这个功能进行分批滚动执行；

![image-20230327114524491](media/image-20230327114524491.png)

- 滚动策略

  遵循作业平台制定的标准规范，将你的分批策略以表达式注明
  - 表达式规范
    - 每个占位以 `空格` 分隔
    - 每个占位只允许出现 `n` `n%` `*n` `+n`，且 `n` 只能为整数
    - `100%` 只允许出现在末位
    - 运算符（`*` 和 `+`）只允许出现在数字n前
    - 算式（如 `+n` 或 `*n`）只允许出现在末位
    - 不允许出现 `0`
  - 含义说明
    - n
    n 必须为整型数值，代表具体多少台
    - n%
    n 必须为整型数值，代表总量的百分之n台（遇小数点则向上取整）
    - +n
    代表每次在前一批数量的基础上增加n台
    - *n
    代表每次在前一批数量的基础上乘于n台

- 滚动机制

  设置该任务滚动过程中出现各种状况时，以什么机制应对（如忽略、暂停、终止等等）
  - 默认（执行失败则暂停）
    当中间批次出现执行失败的情况时，任务会暂时中止，待用户指令继续执行或完全终止
  - 忽略失败，自动滚动下一批
    即便滚动期间出现执行失败的情况，任务也会忽略直至所有批次执行完毕
  - 不自动，每批次都人工确认
    每个批次都会暂停以待用户确认执行动作（继续或终止）

- 示例
我有100台主机需要处理，但想要分批次执行，第一批次固定执行20台，而后每个批次逐渐递增数量直至全部执行完毕：
```
20 +10
```

![image-20230327115715266](media/image-20230327115715266.png)
