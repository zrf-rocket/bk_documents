# 语音消息

本文以腾讯云为例

蓝鲸内置了邮件、短信、语音消息、微信的通知渠道

> 若想接入第三方消息通知（例飞书，钉钉），请参考 [组件编码](../../../APIGateway/DevelopTools/chapter1.md)，将新接口接入至`CMSI蓝鲸消息管理`，并能通过 `[CMSI] 查询消息发送类型` 接口查到即可。

## 配置消息渠道

[配置消息通知：语音消息](../../../PaaS/1.0/UserGuide/UserCase/send_voice_msg.md)

## 配置人员信息

- 联系方式配置

用户管理 -> 组织架构 -> 选择用户 -> 编辑 -> 填好相应的用户信息 -> 保存

- 用户角色配置

配置平台 -> 资源 -> 业务 -> 选择相应业务 -> 编辑角色 -> 保存

# 各平台短信配置

## 作业平台

作业平台 -> 消息通知 -> 勾选需要的消息通知服务

![-w2021](assets/20210528180013.png)

### 作业平台-通知模板配置

作业平台 -> 全局配置 -> 通知设置 -> 编辑需要的模板

![-w2021](assets/20210529102829.png)

可根据已有的内置变量，自定义模板内容。

![-w2021](assets/20210529105050.png)

若腾讯云审核生效完毕，即可点击消息预览，测试发送通知效果，记得保存模板。

### 作业平台-语音模板示例

- 示例一：执行失败

蓝鲸模板内容

```bash
作业平台通知：您的业务[{{task.app.name}}]当前有一个任务:{{task.name}}({{task.detail.url}})执行失败，请尽快查看。
```

腾讯云模板 - 短信内容

```bash
作业平台通知：您的业务[{1}]当前有一个任务:{2}({3})执行失败，请尽快查看。
```

- 示例二：执行成功

蓝鲸模板内容

```bash
作业平台通知：您的业务[{{task.app.name}}]当前有一个任务:{{task.name}}({{task.detail.url}})已执行成功，请尽快查看。
```

腾讯云模板 - 短信内容

```bash
作业平台通知：您的业务[{1}]当前有一个任务:{2}({3})已执行成功，请尽快查看。
```


## 标准运维

### 标准运维-消息通知配置

方法一：使用标准运维自带消息通知

该方法为标准运维固定模板，需要去腾讯云提交短信模板

标准运维 -> 选择业务 -> 项目流程 -> 新建 -> 基础信息（右上角第二个按钮）

![-w2021](assets/20210529114929.png)

方法二：使用标准运维插件`蓝鲸服务(BK)-发送通知`

添加标准插件节点 -> 选择插件：蓝鲸服务(BK)-发送通知 -> 选择相应通知方式、通知分组、通知主题、通知内容 -> 保存

该方法为用户自定义模板，需要先去腾讯云提交短信模板

![-w2021](assets/20210529114841.png)

### 标准运维-语音模板示例

- 示例一：执行失败

腾讯云模板 - 短信内容

```bash
您在{1}业务中的任务{2}执行失败，当前失败节点是{3}，操作员是{4}，请前往标准运维APP({5})查看详情！
```

- 示例二：执行成功

腾讯云短信正文模板 - 短信内容

```bash
您在{1}业务中的任务{2}执行成功，操作员是{3}，请前往标准运维APP({4})查看详情！
```

## 流程服务

暂不支持语音消息通知

## 监控平台

### 监控平台-消息通知配置

监控平台 -> 全局设置 -> 开启需要的消息通知渠道及消息队列 -> 提交

![-w2021](assets/16051505458006.jpg)

监控平台 -> 告警组 -> 根据不同角色编辑相应通知方式 -> 提交

![-w2021](assets/20210529153317.png)

![-w2021](assets/20210620163851.png)

> 告警需要开启相关策略配置

### 监控平台-监控告警示例

以下用 应用内存使用率 策略来配置

策略 -> 找到 应用内存使用率 -> 编辑

设置 检测算法

![-w2021](assets/20210529153738.png)

设置 高级设置 - 告警通知模板

![-w2021](assets/20210620170836.png)

设置 通知设置

![-w2021](assets/20210529153824.png)

记得保存

### 监控平台-短信模板示例

- 模板：通用告警

腾讯云短信正文模板 - 短信内容

```bash
蓝鲸监控通知{1}
```

- 实际收到通知

```bash
蓝鲸监控通知，当前蓝鲸业务应用内存使用率下发生预警告警
```

## 故障自愈

### 故障自愈-消息通知配置

- 故障自愈 -> 选择业务 -> 接入自愈 -> 添加接入自愈 -> 选择告警类型、自愈套餐、通知方式、通知人员、其他信息 -> 添加自愈策略

![-w2021](assets/markdown-img-paste-20200403211512980.png)

![-w2021](assets/20210620171317.png)

### 故障自愈-短信模板示例

- 模板一：通用模板

腾讯云模板 - 短信内容

```bash
故障自愈{1}
```

## 常见问题

问题 1. 没有收到语音通知，怎么排查？

解决方法：
1. 检查蓝鲸消息通道是否配置好，调用接口即可测试，若不成功，请参考 [配置消息通知：语音消息](../../../PaaS/1.0/UserGuide/UserCase/send_voice_msg.md)
2. 检查平台是否开启了消息通知，去相应平台的消息通知配置查看
3. 检查平台是否创建相应的语音模板，例：作业平台 -> 全局配置 -> 通知设置
4. 检查是否创建相应的腾讯云短信模板，去腾讯云云产品 -> 短信 -> 国内短信 -> 正文模板管理
5. 去腾讯云云产品 -> 语音消息 -> 统计分析 -> 语音记录/失败分析-> 查看失败原因

