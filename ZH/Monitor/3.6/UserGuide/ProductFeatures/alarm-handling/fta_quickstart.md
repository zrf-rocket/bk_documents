# 快速使用故障自愈能力

## 了解三个步骤

1. 定义告警源，默认使用蓝鲸监控本身的告警
2. 定义处理套餐，告警处理应该执行的具体逻辑
3. 定义告警策略，在告警策略里关联处理套餐达到自动执行的目的

## 第一步：告警源

默认使用蓝鲸监控不需要接入告警源，本身蓝鲸监控就是一个告警来源。 

接入更多的监控告警来源[具体查看](../integrations-alerts/custom_alerts_source.md)

## 第二步：处理套餐

处理套餐，定义了告警的处理动作，当告警触发时，除了告警消息发送之外，还可以有告警处理的相关动作，如告警回调，告警处理等功能。此功能，将告警和运维系统联动起来使用，实现故障的自动处理，自动愈合。

### 处理套餐列表

处理套餐，如下图所示。
![](media/16616646263138.jpg)




1. 处理套餐说明：通过告警策略可以触发处理套餐，处理套餐可以与周边系统打通完成复杂的功能。
2. 套餐类型：默认支持HTTP回调，作业平台，标准运维，流程服务
3. 关联策略： 配置该套餐的策略
4. 触发次数(近7天)：只算处理记录列表里面的，不算收敛和屏蔽的数量。而且可以直接点击跳转到处理记录。
5. 默认的套餐： 默认的异常通知、告警恢复通知、无数据通知等都是内置的策略，不允许修改，所以需要增加一个标识『默认』；并且禁用删除，tips说明，默认策略不允许删除。 内置了4个默认的通知套餐，用户不可删除。
    * 默认告警异常通知
    * 默认告警恢复通知
    * 默认无数据告警通知
    * 默认告警关闭通知


### 新增处理套餐

![](media/16616646753137.jpg)


基本信息

* 套餐名称：在策略中使用的时候方便辩识
* 是否启用：默认启用
* 说明：描述该套餐的用途

套餐信息

* 套餐类型：默认支持HTTP回调，作业平台，标准运维，流程服务
* 当选择不同的套餐类型，需要填写的信息不同
* 失败判断：设置执行的超时时间，在规定时间未执行完毕后，按执行失败处理。

套餐说明

* 对不同套餐说明用法

变量列表

* [参考套餐内置变量](./solutions_parameters_all.md)


## 第三步：告警策略

在告警策略中使用套餐

告警策略中，在告警处理的动作上面，选择我们已经配置好的处理套餐

![](media/16616647228224.jpg)


防御规则

防御规则分为两部分：

* 判断条件 : 当遇到相同的， 主机、策略、模块、主机、维度、目标、机架、交换机、机房、进程名称、端口、告警特性时。 （去掉业务，因为默认就有业务维度）
* 判断窗口 : 在N分钟内触发M次以上时

执行防御动作 ：
    
* 成功后跳过
* 执行中跳过
* 执行中等待
* 异常防御审批
* 超出后汇总
* 具体说明查看[防御规则列表](./solutions_convergence_rules.md)

举例：

如重启服务器，正常不应该会在同一时间需要重启上百台服务器，因为执行操作是数据驱动的，一旦数据判断出现异常，需要有防御机制来保证不会过多执行。

## 告警事件

在告警事件中可以查看到具体的执行情况 ，具体查看[告警处理记录](../alarm-analysis/alert_recording.md)

当告警策略未配置相关处理套餐，但收到告警后想快速执行或者获取相关信息（例如获取TOP10的进程信息 或者 手动执行触发流程等）的时候，支持手动调用处理套餐来满足需求。


![](media/16616650336934.jpg)

