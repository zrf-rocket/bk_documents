# 如何自定义通知模版

## 告警通知模版设置位置

在策略配置中，我们可以在**高级选项**  ->  **告警通知模板**中配置当这条策略被触发后发出的通知内容的**可自定义**部分。

![-w2021](media/15809932187482.jpg)

监控平台提供了一份默认的告警通知模板，它能在不同的通知中显示不同的样式，可以使用**模板预览**功能看看它们会被渲染成什么样。当然，模板预览功能只是提供了一些**示例数据**，真正的效果需要考虑实际情况。

![-w2021](media/15809932675311.jpg)

## 模板语法说明

由于发送类型有文本、邮件、语音等多种形式，为了方便用户定义出在不同通知渠道都能正常显示的通知模板，监控平台提供了一种行模板语法。

```bash
#label#content
```

必须由#号开头，分为标签和内容两部分，由#号分隔。不符合行模板的内容将会当成普通文本进行显示。

为了保证邮件内容的正常显示，建议用户自定义的通知模板都使用行模板语法。

### 模板变量

关于本次告警通知的相关信息以模板变量的形式提供，可以在模板变量中直接引用，它们会在通知时被渲染对应的信息。

可以通过**变量列表**查看有哪些能用的变量。

![-w2021](media/15809934446872.jpg)

**CMDB 变量**：部分变量仅在监控对象为主机、进程、服务实例等时才能成功取值，如果取值失败则会返回空值。

**内容变量**：供默认模板使用内置变量，会在不同的通知方式中显示不同的值，不需要添加行模板。

**告警变量**：告警内容相关信息。

**策略变量**：产生本次告警的策略相关的信息。

## 配置示例

只需要使用行模板加模板变量，就可以配置出个性化的通知模板。

### 示例一： 更改顺序符合阅读习惯

调整默认通知模板的变量顺序，需要注意的是，content 中的部分变量只在特定通知方式中显示。

{{content.content}}变量被我挪到了下面。

```html
{{content.level}}
{{content.time}}
{{content.duration}}
{{content.target_type}}
{{content.data_source}}
{{content.current_value}}
{{content.biz}}
{{content.target}}
{{content.dimension}}
{{content.content}}
{{content.detail}}
```

微信

```bash
[致命] 磁盘使用率
时间: 1970-01-01 00:00:00
目标: 蓝鲸[2] 127.0.0.1，127.0.0.2 (2)
维度: 磁盘=C
内容: 已持续10分钟， sum(in_user) > 10
详情: http://example.com/
```

短信

```bash
监控通知，[致命]磁盘使用率
目标: 蓝鲸[2] 127.0.0.1，127.0.0.2 (2)
维度: 磁盘=C
内容: 已持续10分钟， sum(in_user) > 10
告警ID: 12345
```

### 示例二：裁减多余的内容

删除不需要的信息，精简通知内容。

```html
{{content.time}}
{{content.content}}
{{content.detail}}
```

微信

```bash
[致命] 磁盘使用率
时间: 1970-01-01 00:00:00
内容: 已持续10分钟， sum(in_user) > 10
详情: http://example.com/
```

短信

```bash
监控通知，[致命]磁盘使用率
内容: 已持续10分钟， sum(in_user) > 10
告警ID: 12345
```

### 示例三： 增加相关主机的信息

通过变量可以获取主机的相关信息。

```html
{{content.time}}
{{content.content}}
#操作系统#{{target.host.bk_os_name}}
{{content.detail}}
```

微信

```bash
[致命] 磁盘使用率
时间: 1970-01-01 00:00:00
内容: 已持续10分钟， sum(in_user) > 10
操作系统: linux centos
详情: http://example.com/
```

短信

```bash
监控通知，[致命]磁盘使用率
内容: 已持续10分钟， sum(in_user) > 10
操作系统: linux centos
告警ID: 12345
```

### 示例四： 通知内容生成特定的一个 URL 链接

告警内容中生成一个 URL，点击即可访问指定内容。

```html
{{content.time}}
{{content.content}}
{{content.detail}}
#xx系统#http://xxxx.demo.com?control=3&host={{target.host.bk_host_innerip}}
```

微信

```bash
[致命]
时间: 1970-01-01 00:00:00
内容: 已持续10分钟， sum(in_user) > 10
详情: http://example.com/
xx系统: http://xxxx.demo.com?control=3&host=127.0.0.1
```

短信

```bash
监控通知，[致命]
内容: 已持续10分钟， sum(in_user) > 10
告警ID: 12345
xx系统: http://xxxx.demo.com?control=3&host=127.0.0.1
```

### 示例五： 关键字监控增加原始的日志内容

待完善


