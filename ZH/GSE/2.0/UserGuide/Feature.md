# 产品功能

蓝鲸管控平台（Blueking General Service Engine），以下简称'GSE', 提供任务执行、文件传输、数据传输、进程管理等基础通道能力。

![feature](./assets/feature.png)

- **任务执行**：提供目标管控节点上的远程作业任务执行能力，如Bash、Perl、Bat、PowerShell、Python、SQL等；
- **文件传输**：提供文件快速传输能力，结合BT网络协议和内部私有协议实现在不同的文件大小和节点规模下，动态调整组网策略以此达到最佳的文件传输效率，为业务提供高效稳定的底层文件传输服务；
- **数据传输**：提供海量数据传输和路由管理能力, 结合蓝鲸采集器插件提供业务自定义数据的采集和上报能力, 该服务提供无损升级和Agent侧的故障转移能力, 为日常变更和故障发生时提供数据传输保障, 同时还提供全链路数据压缩功能, 以此减少传输链路带宽消耗;
- **进程管理**：提供目标管控节点上的进程管理功能，如进程的注册托管、进程启停控制、进程CPU/MEM资源保护等；

## 详细功能特点

### 任务执行

**任务类型:**

|   任务类型  |                                                                          说明                                                                     |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| 命令类型    | Linux 支持 Bash 命令、Windows 支持 CMD 命令，支持各种自定义可执行文件格式程序的启动，支持各种解释性语言程序的执行。                               |
| 脚本类型    | Linux 支持 Shell 脚本、Windows 支持 Bat 脚本(安装有 cygwin 的额外支持 Shell 脚本)，以及各种系统支持的解释性脚本程序(Python, PowerShell, Perl等)。 |

**任务控制:**

|   任务控制    |                                                                                                       说明                                                                                                            |
| ------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 指定用户执行  | Linux 系统支持按指定用户执行任务，例如用户设定以 user00 用户执行 ps，则只能看到该用户权限范围内的结果；因为 Windows 操作系统的限制，只有开启校验机器密码功能的用户才能指定用户执行任务，否则需以 SYSTEM 用户执行任务。|
| 继承用户环境  | Linux / Windows 系统支持指定用户后继承该用户设定的环境变量。                                                                                                                                                          |
| 校验机器密码  | 用户可以选择是否校验机器密码，如果选择不校验，则 Windows 系统下不支持按指定用户执行任务的功能。                                                                                                                       |

**任务管理:**

|    任务管理   |                                              说明                                                          |
| ------------- | ---------------------------------------------------------------------------------------------------------- |
| 状态管理      | 任务处理核心逻辑支持更准确高效的任务状态确认和管理机制，保证例如Agent宕机等异常情况下任务状态可以不受影响。|
| 简单易用的API | 提供简单易用接入成本较低的HTTP协议API支持，方便查询指定任务的执行状态以及任务下所有Agent任务执行状态。     |

### 文件传输

**传输模式:**

|   传输模式  |                                                   说明                                                                   |
| ----------- | ------------------------------------------------------------------------------------------------------------------------ |
| BT模式      | 对于大于 10KB 的文件，将自动启用 BT 作为首选的传输方式。                                                                 |
| 直传模式    | 对于 10KB 以下的小文件，将使用 TCP 数据流直传模式。                                                                      |
| 混合模式    | 在 BT 模式下，如果发生 BT 传输持续性失败，则会尝试使用直传模式传输 BT 文件分片，当 BT 传输恢复时，则自动切换至 BT 模式。 |

**传输类型:**

|    传输类型   |                                                                                                             说明                                                                                                                       |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 文件传输      | 传输单个文件到指定机器节点，这里文件可以是任何格式，任何可读目录下的可读文件, 文件传输完成后，会自动同步目标文件权限与源文件一致。对于直传模式，文件传输结束后会进行 MD5 校验，对于 BT 模式和混合模式，会进行 hash 值校验文件的完整性。|
| 目录传输      | 支持将用户指定的目录传输到一批机器的指定可写目录下，保证目录的结构和权限不变。                                                                                                                                                         |
| 正则匹配传输  | 支持将用户通过通配符（符合通用正则表达式）匹配一批文件传输到指定机器的指定可写目录，保证传输完成后文件的格式和权限与源文件保持一致。                                                                                                   |
| 动态策略传输  | 根据需要传输的文件大小和结构动态控制传输策略，支持对目录、正则、通配符路径匹配模式下的非压缩传输，避免额外解压缩开销，减少传输耗时。                                                                                                   |

**传输控制:**

|    传输控制   |                                                                                                             说明                                                                                                                                   |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 区域链控制    | 让文件沿着指定的路径，通过多个中转节点的接力，最终到达目标机器，并且源文件和目标文件所在机器不在同一个物理或逻辑区域，我们称这种传输方式为区域链传输。区域链控制是指通过一定规则指定文件中转的路径，以满足具有特殊专线链接的两个区域间的传输需求。 |
| 跨区域穿透    | 跨区域穿透是指原本相互隔离的两个区域，由于特殊目的，需要就本次传输进行定向透传。蓝鲸管控平台允许权限用户适当配置组网来完成定向区域之间的正向穿透和反向穿透。                                                                                       |

### 数据传输

**采集方式:**

|  采集方式  |                                                                                                     说明                                                        |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 采集器插件 | 支持蓝鲸采集器插件模式的数据采集和上报，Agent会自动加载采集插件，并监控插件的存活状况。如果采集插件异常终止，则重新拉起采集插件, 如果多次拉起失败则会触发告警。 |

**传输控制:**

|   传输控制     |                                                                                                     说明                                                                                                                 |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 动态负载均衡   | 由于数据采集的量级可能较大，且具有随业务特性波动的特点，为了合理分配服务端机器的利用率，减少由于数据量变化时带来的负载不均衡问题，系统支持基于多维度加权负载信息进行数据转发动态调整，以达到集群内服务端负载均衡的目的。 |
| 全链路数据压缩 | 支持Agent到服务端以及Proxy到服务端等混合网络拓扑下的全链路数据压缩传输能力, 通过数据的压缩可以大大减少传输过程中对链路带宽的消耗。                                                                                       |
| 服务无损升级   | 结合网络协议栈的能力提供服务模块的无损升级, 为日常变更时提供数据传输的平滑过渡支持，为业务数据传输质量提供保障。                                                                                                         |
| 快速故障转移   | 基于内部动态探测机制，支持数据链路的快速故障转移能力, 在故障发生时可最大限度保证数据传输不受影响。                                                                                                                       |
| 高性能传输     | 提供基于内存和网络深度优化下的高性能数据传输能力，保证整体负载均匀的情况下最大程度发挥核心转发节点的性能, 提供高效低延时的数据传输服务。                                                                                 |

### 进程管理

**管理维度:**

|   管理维度          |                                                               说明                                                                  |
| ------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| 进程注册托管        | 被托管的进程由Agent进行守护，在进程异常退出时会按照配置的指令将自动将其拉起，且Agent会对被托管的进程执行“进程CPU/MEM资源保护”策略。 |
| 进程启停控制        | 提供进程操作相关的API，通过此类API可以实现同时对多主机进程启停等场景化操作。                                                        |
| 进程CPU/MEM资源保护 | Agent针对自己以及被其托管的进程的CPU/MEM资源进行监测，当被监测的进程的CPU/MEM资源使用率超过配置的使用率阀值时会被强制重启。         |

### 平台能力

**混合网络纳管:**

|    混合网络纳管   |                                             说明                                                  |
| ----------------- | ------------------------------------------------------------------------------------------------- |
| IPv4/IPv6混合网络 | 支持IPv6环境、IPv4环境以及IPv6和IPv4混合的网络环境纳管。                                          |
| 异构网络穿透      | 支持在常见异构网络环境下，突破DHCP、NAT、Virtual IP等限制，实现混合云环境纳管。                   |

**信令控制:**

|  信令控制 |                                                  说明                                                 |
| --------- | ----------------------------------------------------------------------------------------------------- |
| 高性能    | 深度优化的核心信令控制逻辑，缩短大规模信令下发的系统耗时，提高了系统承载能力。                        |
| 低延迟    | 基于内部私有协议实现MsgBus组件，具备高效的路由寻址和快速路由恢复能力，提供低延迟的信令下发和转发服务。|

**SRE:**

|  SRE    |                            说明                                  |
| ------- | ---------------------------------------------------------------- |
| 可运维  | 提供配套的运维工具用于排查现网故障，快速检测现网服务状态和质量。 |
| 可观测  | 提供基于OpenTelemetry协议的在线日志、指标监控和调用链追踪。      |
| 可度量  | 提供基于私有协议的内部运营数据上报与统计，便于系统服务运营分析。 |
